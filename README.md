*Этот проект представляет собой backend решение для автоматизации закупочного процесса в рамках
курса **«Python-разработчик: расширенный курс»**.*

## **Основные возможности проекта:**

- Управление поставщиками и товарами через API интерфейсы.

- Поддержка импорта товаров из YAML-файлов.

- Система управления заказами с возможностью оформления и подтверждения заказов.

- Автоматическая отправка email-подтверждения клиентам после регистрации и оформления заказа.

- Детальное ведение карточек товаров с указанием цен, количества на складе и атрибутов.

- Администрирование и управление всеми объектами через встроенную административную панель Django.

## Инструкция по разворачиванию проекта

### Предварительные условия:

- **Установленный Python 3.10+**
- **Любая совместимая база данных**
- **pipenv** или **virtualenv** для изоляции зависимостей

### Установка и запуск:

Склонируйте репозиторий:

`git clone https://github.com/pyLexxDramma/my-ordering-service.git`
`cd my-ordering-service`

Активируйте виртуальное окружение:

**Linux/Mac**
`python -m venv .venv`

`source .venv/bin/activate`

**Windows**

`python -m venv myenv`

`.venv\Scripts\activate.bat`

Установите зависимости:

`pip install -r requirements.txt`

Склонируйте переменные окружения:

Создайте базу данных и запустите миграции:

`python manage.py migrate`
Загрузите тестовые данные (при наличии):

`python manage.py loaddata initial_data.yaml`
Запустите сервер разработки:

`python manage.py runserver`
Проект будет доступен по адресу
**http://localhost:8000/**.

**Основные API включают:**

- Регистрацию и авторизацию пользователей.

- Каталог товаров и подробную информацию о продуктах.

- Логику корзины покупок и оформление заказов.

- Функционал отправки email-клиентам.

- **Тестирование:**

Тесты реализованы с использованием стандартных инструментов тестирования Django. Их можно запустить следующей командой:

`python manage.py test`

## **История разработки:**

- Внедрение базовых моделей данных и начальной инфраструктуры.

- Реализация функционала импорта товаров из YAML-файлов.

- Организация работы с пользователями, регистрацией и аутентификацией.

- Расширение API для взаимодействия с корзинами и заказами.

- Завершающая интеграция системы отправки email.

## Документация API сервиса магазина:

Доступные эндпоинты API для сервиса магазина, включая базовые функции аутентификации, управления корзиной, оформления
заказов и просмотра информации о товарах.

---

### 1. Аутентификация

| Метод  | URL              | Описание                             | Требования                                                 |
|:-------|:-----------------|:-------------------------------------|:-----------------------------------------------------------|
| `POST` | `/api/register/` | Регистрация нового пользователя      | `username`, `email`, `password`, `first_name`, `last_name` |
| `POST` | `/api/login/`    | Вход пользователя (получение токена) | `username`, `password`                                     |

---

### 2. Товары, Категории, Поставщики (ReadOnly)

| Метод | URL                     | Описание                                 | Требования      |
|:------|:------------------------|:-----------------------------------------|:----------------|
| `GET` | `/api/products/`        | Получение списка всех товаров            | -               |
| `GET` | `/api/products/{id}/`   | Получение деталей конкретного товара     | `id` товара     |
| `GET` | `/api/categories/`      | Получение списка всех категорий          | -               |
| `GET` | `/api/categories/{id}/` | Получение деталей конкретной категории   | `id` категории  |
| `GET` | `/api/suppliers/`       | Получение списка всех поставщиков        | -               |
| `GET` | `/api/suppliers/{id}/`  | Получение деталей конкретного поставщика | `id` поставщика |

---

### 3. Корзина

| Метод    | URL                     | Описание                                                | Тело запроса (JSON)                      | Требования                                                        |
|:---------|:------------------------|:--------------------------------------------------------|:-----------------------------------------|:------------------------------------------------------------------|
| `GET`    | `/api/cart/`            | Просмотр содержимого корзины текущего пользователя      | -                                        | Требуется аутентификация.                                         |
| `POST`   | `/api/cart/items/`      | Добавление товара в корзину (или увеличение количества) | `{ "product_id": int, "quantity": int }` | Требуется аутентификация. `product_id` - ID существующего товара. |
| `PUT`    | `/api/cart/items/{id}/` | Обновление количества товара в корзине                  | `{ "quantity": int }`                    | Требуется аутентификация. `id` - ID элемента корзины.             |
| `PATCH`  | `/api/cart/items/{id}/` | Частичное обновление количества товара (то же, что PUT) | `{ "quantity": int }`                    | Требуется аутентификация. `id` - ID элемента корзины.             |
| `DELETE` | `/api/cart/items/{id}/` | Удаление товара из корзины                              | -                                        | Требуется аутентификация. `id` - ID элемента корзины.             |

---

### 4. Заказы

| Метод   | URL                               | Описание                                            | Тело запроса (JSON)                                                | Требования                                                                                                                                                                            |
|:--------|:----------------------------------|:----------------------------------------------------|:-------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `POST`  | `/api/orders/`                    | Создание нового заказа из корзины                   | `{ "cart_id": int, "shipping_address": str, "phone_number": str }` | Требуется аутентификация. `cart_id` - ID корзины, из которой создается заказ. `shipping_address` и `phone_number` (или берутся из профиля `Customer`). Корзина должна быть не пустой. |
| `GET`   | `/api/orders/`                    | Получение списка всех заказов текущего пользователя | -                                                                  | Требуется аутентификация.                                                                                                                                                             |
| `GET`   | `/api/orders/{id}/`               | Получение деталей конкретного заказа                | -                                                                  | Требуется аутентификация. `id` - ID заказа. Пользователь может просматривать только свои заказы.                                                                                      |
| `PATCH` | `/api/orders/{id}/confirm_order/` | Изменение статуса заказа (для администратора)       | `{ "status": "confirmed"                                           | "cancelled"                                                                                                                                                                           | "shipped" | ... }` (выберите допустимый статус) | Требуется аутентификация **администратора**. `id` - ID заказа.                                                                                                                                      |

---

### 5. Особые проверки (тестировались)

* **Автоматическое создание корзины:** Корзина создается автоматически при первом добавлении товара, если ее нет.
* **Очистка корзины после заказа:** Корзина и ее элементы автоматически удаляются после успешного создания заказа.
* **Отправка email подтверждения заказа:** Отправляется при успешном создании заказа (`POST /api/orders/`) и при ручном
  изменении статуса на "confirmed" администратором.
* **Обработка ошибок:** Корректная обработка ошибок аутентификации, авторизации, невалидных данных, отсутствующих
  объектов.
* **Права доступа:** Анонимные пользователи не имеют доступа к корзине и заказам. Обычные пользователи видят только свои
  заказы. Администраторы могут подтверждать заказы.

